name: release

on:
  push:
    tags:
    - 'v*'

jobs:
  excavate:
    name: release
    runs-on: windows-2022
    steps:
    - uses: actions/checkout@main
    - uses: actions/setup-python@v5
      with:
        python-version: '3.13'
    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v2
      with:
        vs-version: '[17,18)'
        msbuild-architecture: x64
    - name: submodule
      run: git submodule update --init --recursive
    - name: build
      run: python ci.py
    - name: Create Release
      uses: softprops/action-gh-release@v2
      with:
          files: protobuf-c-win64.zip
